!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("TypoReporter",[],t):"object"==typeof exports?exports.TypoReporter=t():e.TypoReporter=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,o){"use strict";function n(e,t,o){if("string"!=typeof e)throw new Error("tagName must be a string");var n=document.createElement(e);return t&&"object"===("undefined"==typeof t?"undefined":r(t))&&Object.keys(t).forEach(function(e){/on[A-Z][a-z]/.test(e)?n[e.toLowerCase()]=t[e]:n.setAttribute(e,t[e])}),"string"==typeof o?n.innerHTML=o:o instanceof Array&&o.forEach(function(e){n.appendChild(e)}),n}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=n,e.exports=t.default},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t){if(e=e||{},!t)throw new Error('"rootNode" is not passed');if(!e.formId)throw new Error('"formId" option is not defined');if(e.snippetFieldName=e.snippetFieldName||"entry.13240190",e.urlFieldName=e.urlFieldName||"entry.238687347",e.commentFieldName=e.commentFieldName||"entry.1447231081",e.endpointUrl=e.endpointUrl||"https://cors-anywhere.herokuapp.com/https://docs.google.com/forms/d/e/"+e.formId+"/formResponse?embedded=true",e.offset=e.offset||50,e.translations=e.translations||this.translations,e.locale=e.locale||"en",!e.translations[e.locale])throw new Error("No translations defined for locale "+e.locale);e.messagePlaceholder=e.messagePlaceholder||"",this.i18n=e.translations[e.locale],this.props=e,this.node=t,this.state={},this.submit=this.submit.bind(this),this.handleCommentChange=this.handleCommentChange.bind(this),this.closeDialog=this.closeDialog.bind(this),document.addEventListener("keydown",function(e){e.ctrlKey&&13===e.which&&this.showDialog(),27===e.which&&this.closeDialog()}.bind(this)),this.refresh()}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),a=n(i);s.prototype.translations={en:{header:"Report a mistake on the page",messageLabel:"There is a mistake in the following text:",commentLabel:"<strong>Do you want to send a notice to a webmaster?</strong>",send:"<strong>Send</strong>",sending:"Sending",cancel:"Cancel",error:"Error! Something went wrong..."},ru:{header:"Сообщите об ошибке на странице",messageLabel:"Ошибка содержится в следующем тексте:",commentLabel:"<strong>Отправить сообщение об ошибке редактору сайта?</strong>",send:"<strong>Отправить</strong>",sending:"Отправляю",cancel:"Отмена",error:"Ошибка! Что-то пошло не так..."}},s.prototype.render=function(){var e=this.state,t=this.i18n;return e.isOpen&&(0,a.default)("div",{},[(0,a.default)("div",{class:"ReportTypo-overlay",onClick:this.closeDialog}),(0,a.default)("div",{class:"ReportTypo"},[(0,a.default)("button",{type:"button",class:"ReportTypo-cancel",onClick:this.closeDialog}),(0,a.default)("div",{class:"ReportTypo-header"},t.header),(0,a.default)("div",{class:"ReportTypo-label"},t.messageLabel),(0,a.default)("div",{class:"ReportTypo-message"},e.snippet.replace(">>>",'<u class="ReportTypo-heighlight">').replace("<<<","</u>")),(0,a.default)("div",{class:"ReportTypo-comment-container"},[(0,a.default)("textarea",{class:"ReportTypo-comment",onKeyup:this.handleCommentChange,placeholder:"Test"},e.comment)]),(0,a.default)("div",{class:"ReportTypo-label"},t.commentLabel),(0,a.default)("div",{class:"ReportTypo-submit-container"},[(0,a.default)("button",{type:"button",class:"ReportTypo-submit",onClick:this.submit},e.isSending?t.sending:t.send)]),(0,a.default)("div",null,e.isError&&t.error)])])},s.prototype.refresh=function(){var e=this.node;e.innerHTML="";var t=this.render();t&&e.appendChild(t)},s.prototype.submit=function(){var e,t=this,o=this.state,n=this.props;o.isSending=!0,this.refresh();var s={data:(e={},r(e,n.snippetFieldName,o.snippet),r(e,n.commentFieldName,o.comment),r(e,n.urlFieldName,window.location.href),r(e,"language",n.locale),e)};fetch(n.endpointUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.json()}).then(function(){t.closeDialog()}).catch(function(e){console.error(e),o.isError=!0,o.isSending=!1,t.refresh()})},s.prototype.getSnippet=function(){var e=this.props,t=document.getSelection(),o=t.toString();if(o){var n=t.getRangeAt(0),r=document.createRange(),s=document.createRange();r.setStartBefore(n.startContainer.ownerDocument.body),r.setEnd(n.startContainer,n.startOffset),s.setStart(n.endContainer,n.endOffset),s.setEndAfter(n.endContainer.ownerDocument.body);var i=r.toString().substr(-e.offset),a=s.toString().substr(0,e.offset),l=i+">>>"+o+"<<<"+a,c=document.createElement("div");return c.innerHTML=l,c.innerText.replace(/\r?\n|\r/g,"").replace(/\s+/g," ")}},s.prototype.showDialog=function(){var e=this.state;e.snippet=this.getSnippet(),e.snippet&&(e.isOpen=!0,this.refresh())},s.prototype.closeDialog=function(){this.state={},this.refresh()},s.prototype.handleCommentChange=function(e){this.state.comment=e.target.value},t.default=s,e.exports=t.default}])});